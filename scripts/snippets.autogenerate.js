// this file is responsible for providing auto generated snippets

const fs = require("fs");
const snippets = {};
let files = fs.readdirSync(__dirname + "/../data/SallaJson/snippets.twig/");
files.forEach((f) => {
  let name = f.replace(".twig", "");
  snippets[name] = {
    prefix: "Salla " + name,
    body: fs.readFileSync(
      __dirname + "/../data/SallaJson/snippets.twig/" + f,
      "utf8"
    ),
    description: name,
    scope: "text.html.twig",
  };
});

fs.writeFileSync(
  __dirname + "/../data/SallaJson/salla.snippets.autogenerated.json",
  JSON.stringify(snippets, null, 2)
);

// start collecting data
function getJson(relativePath) {
  let file = fs.readFileSync(__dirname + relativePath, "utf8");
  return JSON.parse(file);
}
const snippetsArr = {
  // salla
  ...getJson("/../data/SallaJson/salla.snippets.autogenerated.json"),
  ...getJson("/../data/SallaJson/hover/salla.filters.json"),
  ...getJson("/../data/SallaJson/hover/salla.functions.json"),

  // twig
  ...getJson("/../data/Twig/snippets/snippets.json"),
  ...getJson("/../data/Twig/hover/filters.json"),
};

const functionsArr = getJson("/../data/Twig/hover/functions.json");
const twigArr = getJson("/../data/Twig/hover/twig.json");

const hooks = getJson("/../data/SallaJson/hooks.json");
let components = getJson("/../data/SallaJson/components.json");
let MODALS = {};
let modals_files = fs.readdirSync(
  __dirname + "/../data/SallaJson/modals.twig/"
);

for (let i = 0; i < modals_files.length; i++)
  MODALS[modals_files[i].replace(".json", "")] = getJson(
    "/../data/SallaJson/modals.twig/" + modals_files[i]
  );

// write to json
/*
{
  snippetsArr,
  functionsArr,
  twigArr,
  MODALS,
  hooks,
  components,
};

*/
fs.writeFileSync(
  __dirname + "/../src/___autogenerated_data.js",
  `module.exports = 
    ${JSON.stringify(
      {
        snippetsArr,
        functionsArr,
        twigArr,
        MODALS,
        hooks,
        components,
      },
      null,
      2
    )}
  `
);
fs.writeFileSync(
  __dirname + "/../dist/___autogenerated_data.js",
  `module.exports = 
    ${JSON.stringify(
      {
        snippetsArr,
        functionsArr,
        twigArr,
        MODALS,
        hooks,
        components,
      },
      null,
      2
    )}
  `
);
